---
title: 安装
categories: [guide]
order: 0
meta:
  keywords: ~
  description: ~
---

## 系统要求

CASL 是同构的，因此可以在浏览器和 Node.js 环境中使用。它需要 ES5 兼容环境和 ES6 的 `Map` 类，这意味着支持的最低 Internet Explorer 版本是 IE11，最低 Node.js 版本是 8.x。但我们强烈建议使用最新的 Node.js 环境和浏览器，因为它们的 JS 虚拟机运行速度更快。

此外，`@casl/vue` 和 `@casl/aurelia` 使用 [ES6 WeakMap](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)，因此需要 polyfill 或更新版本的浏览器。

## 语义化版本控制

CASL 在其所有官方项目中遵循[语义化版本控制](https://semver.org/)。更改可以在[发布说明](https://github.com/stalniy/casl/releases)或每个包内的 `CHANGELOG.md` 文件中找到。

## 官方包及其版本

| 项目              | 状态                                 | 描述        |
|-------------------|--------------------------------------|-------------|
| [@casl/ability]   | [![@casl/ability-status]][@casl/ability-package]   | CASL 的核心包 |
| [@casl/mongoose]  | [![@casl/mongoose-status]][@casl/mongoose-package] | 与 [Mongoose][mongoose] 的集成 |
| [@casl/prisma]  | [![@casl/prisma-status]][@casl/prisma-package] | 与 [Prisma][prisma] 的集成 |
| [@casl/angular]   | [![@casl/angular-status]][@casl/angular-package]   | 与 [Angular][angular] 的集成 |
| [@casl/react]     | [![@casl/react-status]][@casl/react-package]       | 与 [React][react] 的集成 |
| [@casl/vue]       | [![@casl/vue-status]][@casl/vue-package]           | 与 [Vue][vue] 的集成 |
| [@casl/aurelia]   | [![@casl/aurelia-status]][@casl/aurelia-package]   | 与 [Aurelia][aurelia] 的集成 |

[@casl/ability]: /guide/intro
[@casl/mongoose]: /package/casl-mongoose
[@casl/prisma]: /package/casl-prisma
[@casl/angular]: /package/casl-angular
[@casl/react]: /package/casl-react
[@casl/vue]: /package/casl-vue
[@casl/aurelia]: /package/casl-aurelia

[@casl/ability-status]: https://img.shields.io/npm/v/@casl/ability.svg
[@casl/mongoose-status]: https://img.shields.io/npm/v/@casl/mongoose.svg
[@casl/prisma-status]: https://img.shields.io/npm/v/@casl/prisma.svg
[@casl/angular-status]: https://img.shields.io/npm/v/@casl/angular.svg
[@casl/react-status]: https://img.shields.io/npm/v/@casl/react.svg
[@casl/vue-status]: https://img.shields.io/npm/v/@casl/vue.svg
[@casl/aurelia-status]: https://img.shields.io/npm/v/@casl/aurelia.svg

[@casl/ability-package]: https://www.npmjs.com/package/@casl/ability
[@casl/mongoose-package]: https://www.npmjs.com/package/@casl/mongoose
[@casl/prisma-package]: https://www.npmjs.com/package/@casl/prisma
[@casl/angular-package]: https://www.npmjs.com/package/@casl/angular
[@casl/react-package]: https://www.npmjs.com/package/@casl/react
[@casl/vue-package]: https://www.npmjs.com/package/@casl/vue
[@casl/aurelia-package]: https://www.npmjs.com/package/@casl/aurelia

[mongoose]: http://mongoosejs.com/
[vue]: https://vuejs.org
[angular]: https://angular.io/
[react]: https://reactjs.org/
[aurelia]: http://aurelia.io
[prisma]: https://www.prisma.io/


## 第三方包

还有一些第三方包可以在我们的项目中使用。要找到它们，只需[在 NPM 上使用 "casl" 关键字搜索](https://www.npmjs.com/search?q=keywords:casl)

> 在 [package.json#keywords](https://docs.npmjs.com/cli/v7/configuring-npm/package-json#keywords) 数组中添加 "casl"，以便在该列表中显示您基于 CASL 的包

## NPM、YARN、PNPM

通过包管理器安装是安装 CASL 的推荐方式。要安装最新稳定版本，请运行：

```sh
npm install @casl/ability
# 或
yarn add @casl/ability
# 或
pnpm add @casl/ability
```

## CDN

对于原型设计或学习目的，您可以使用最新版本：

```html
<script src="https://cdn.jsdelivr.net/npm/@casl/ability"></script>
```

对于生产环境，我们建议链接到特定版本号，以避免新版本带来的意外破坏：

```html
<script src="https://cdn.jsdelivr.net/npm/@casl/ability@5.1.0"></script>
```

请记住，CASL 依赖于 [@ucast/mongo2js]，而后者又依赖于 [@ucast/core]、[@ucast/js] 和 [@ucast/mongo]，这就是为什么您需要在 `@casl/ability` 之前指定所有这些库：

```html
<script src="https://cdn.jsdelivr.net/npm/@ucast/core"></script>
<script src="https://cdn.jsdelivr.net/npm/@ucast/mongo"></script>
<script src="https://cdn.jsdelivr.net/npm/@ucast/js"></script>
<script src="https://cdn.jsdelivr.net/npm/@ucast/mongo2js"></script>
<script src="https://cdn.jsdelivr.net/npm/@casl/ability"></script>
```

[@ucast/core]: https://www.npmjs.com/package/@ucast/core
[@ucast/js]: https://www.npmjs.com/package/@ucast/js
[@ucast/mongo]: https://www.npmjs.com/package/@ucast/mongo
[@ucast/mongo2js]: https://www.npmjs.com/package/@ucast/mongo

## 下载并使用 &lt;script&gt; 标签

只需[从 CDN 下载 CASL](https://cdn.jsdelivr.net/npm/@casl/ability) 并使用 script 标签包含即可。`casl` 将被注册为全局变量。

> 希望您知道自己在做什么

## 不同构建版本的说明

在 NPM 包的 `dist/` [目录](https://cdn.jsdelivr.net/npm/@casl/ability/dist/)中，您会找到 CASL.js 的许多不同构建版本。以下是它们之间差异的概述：

| 构建版本        | 描述                                 |
|-----------------|--------------------------------------|
| es6m/index.mjs    | 支持 ES 模块的压缩 ES6 代码。适用于打包工具（如 [rollup]、[webpack]）为支持 ES 模块的现代浏览器或现代 Node.js 版本创建包 |
| es6c/index.js    | 支持 CommonJS 模块的压缩 ES6 代码。适用于支持 ES6 但不支持 ES 模块的现代 Node.js 环境 |
| es5m/index.js   | 支持 ES 模块的压缩 ES5 代码。应由打包工具（如 [rollup]、[webpack]）使用以进行 tree shaking 并跳过 babel 的转译过程 |
| umd/index.js    | **已弃用**，支持 UMD 的压缩 ES5 代码。适用于 AMD 应用程序和浏览器中的简单原型 |
| types           | 包含 [typescript] 类型声明文件 |

[rollup]: https://rollupjs.org/guide/en/
[webpack]: https://webpack.js.org/
[typescript]: http://www.typescriptlang.org/

所有官方包都具有相同的目录布局（除了 `@casl/mongoose` 没有 es5m 版本，以及与 UI 框架集成的包没有 es6c 版本）。

## Webpack

Webpack 在严格模式下运行 ESM JavaScript。问题是 webpack4 只读取 `package.json` 的 `main` 属性，而忽略 `resolve.mainFields` 中的其他所有内容。所有与 casl 相关的包（包括 ucast）都在 `main` 属性中分发 CommonJS 文件。这导致了以下问题：

> ERROR in ./node_modules/@casl/ability/dist/es6m/index.mjs
> Can't import the named export 'xxx' from non EcmaScript module (only default export is available)

修复此问题的最佳方法是升级到 webpack 5，它在导入包时读取 package.json 的 `exports` 属性，并且能够正确处理 ESM 导入。但如果您仍然使用 webpack 4，请阅读[此评论](https://github.com/stalniy/casl/issues/427#issuecomment-757539486)了解可能的解决方法。

## CSP 环境

某些环境（如 Google Chrome 应用程序）强制执行内容安全策略 (CSP)，该策略禁止使用 `new Function()` 来评估表达式。

CASL 不使用任何被禁止的函数，因此可以在任何环境中自由使用。

## 开发构建

**重要提示**：GitHub 的 `/dist` 文件夹中的构建文件在发布期间不会被检入。要使用 GitHub 上最新源代码的 CASL，您必须自己构建！导航到您的项目根目录并运行：

```sh
git clone git@github.com:stalniy/casl.git
cd casl
pnpm i -r
cd packages/casl-ability
npm run build
```
